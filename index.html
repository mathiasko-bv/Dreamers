<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dreamers - Share Your Dreams</title>
  <link rel="icon" href="logo.png">
  <script type="module">
    // Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-storage.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyA-oYY7TrkutoUzT6TDyv-2zXYrv8jQ8Qk",
      authDomain: "dreamers-28315.firebaseapp.com",
      projectId: "dreamers-28315",
      storageBucket: "dreamers-28315.appspot.com", // corrigÃ©
      messagingSenderId: "2129659896",
      appId: "1:2129659896:web:5c9b6f0188a90085c6f80d",
      measurementId: "G-6PEQFPTJ7N"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);
    const provider = new GoogleAuthProvider();

    // Google Login
    window.loginGoogle = async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('profile-section').style.display = 'block';
        document.getElementById('profile-name').innerText = user.displayName;
        document.getElementById('profile-photo').src = user.photoURL;
      } catch (err) {
        alert("Erreur de connexion : " + err.message);
      }
    };

    // Logout
    window.logout = async () => {
      await signOut(auth);
      document.getElementById('login-section').style.display = 'block';
      document.getElementById('profile-section').style.display = 'none';
    };

    // Poster un rÃªve
    window.postDream = async () => {
      const dreamText = document.getElementById('dream-text').value;
      const fileInput = document.getElementById('dream-image');
      let imageUrl = '';
      if(fileInput.files.length > 0){
        const file = fileInput.files[0];
        const storageRef = ref(storage, 'dreams/' + Date.now() + '-' + file.name);
        await uploadBytes(storageRef, file);
        imageUrl = await getDownloadURL(storageRef);
      }
      await addDoc(collection(db, 'dreams'), {
        text: dreamText,
        image: imageUrl,
        user: auth.currentUser.displayName,
        photo: auth.currentUser.photoURL,
        createdAt: serverTimestamp()
      });
      document.getElementById('dream-text').value = '';
      document.getElementById('dream-image').value = '';
    };

    // Afficher les rÃªves
    const dreamList = document.getElementById('dream-list');
    const q = query(collection(db, 'dreams'), orderBy('createdAt', 'desc'));
    onSnapshot(q, (snapshot) => {
      dreamList.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement('div');
        div.className = 'dream-card';
        div.innerHTML = `
          <img src="${data.photo}" class="user-photo">
          <h4>${data.user}</h4>
          <p>${data.text}</p>
          ${data.image ? `<img src="${data.image}" class="dream-image">` : ''}
        `;
        dreamList.appendChild(div);
      });
    });
  </script>

  <style>
    body { margin:0; font-family: Arial,sans-serif; background:#001f2f; color:#f0f0f0; }
    header { text-align:center; padding:40px 20px; background:#004d40; color:#00c2a0; box-shadow:0 5px 10px rgba(0,0,0,0.5);}
    header h1 { margin:0; font-size:3em; }
    header p { margin:10px 0; font-size:1.2em; color:#a0f0e0; }

    nav { display:flex; justify-content:center; gap:20px; background:#00332f; padding:15px; }
    nav a { color:#00c2a0; text-decoration:none; font-weight:bold; padding:10px 20px; border-radius:50px; transition:0.3s; background:#004d40;}
    nav a:hover { background:#00e0b0; color:#004d40; }

    #login-section { text-align:center; padding:50px; }
    #login-section button { background:#00c2a0; border:none; padding:15px 30px; border-radius:50px; color:#004d40; font-weight:bold; cursor:pointer; transition:0.3s; }
    #login-section button:hover { background:#00e0b0; transform:scale(1.05); }

    #profile-section { display:none; text-align:center; padding:30px; }
    #profile-photo { width:80px; height:80px; border-radius:50%; }
    #dream-input { margin-top:20px; display:flex; flex-direction:column; align-items:center; gap:10px; }
    #dream-input textarea { width:300px; height:80px; border-radius:10px; padding:10px; resize:none; }
    #dream-input input[type=file] { color:#fff; }
    #dream-input button { background:#00c2a0; border:none; padding:10px 20px; border-radius:50px; font-weight:bold; cursor:pointer; transition:0.3s; }
    #dream-input button:hover { background:#00e0b0; transform:scale(1.05); }

    #dream-list { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; padding:20px; }
    .dream-card { background:#004d40; border-radius:15px; padding:15px; text-align:center; box-shadow:0 5px 15px rgba(0,0,0,0.5); transition:0.3s; }
    .dream-card:hover { transform:scale(1.02); box-shadow:0 10px 20px rgba(0,0,0,0.7);}
    .dream-card h4 { margin:10px 0 5px; color:#00e0b0; }
    .dream-card p { color:#f0f0f0; }
    .dream-card .dream-image { width:100%; border-radius:10px; margin-top:10px; }
    .dream-card .user-photo { width:50px; height:50px; border-radius:50%; }

    footer { text-align:center; padding:25px; background:#00332f; color:#00c2a0; }
  </style>
</head>
<body>

  <header>
    <h1>Dreamers</h1>
    <p>Share your dreams with the world ðŸŒŸ</p>
  </header>

  <nav>
    <a href="#login-section">Connexion</a>
    <a href="#dream-list">RÃªves</a>
    <a href="#profile-section">Profil</a>
  </nav>

  <!-- Section connexion -->
  <section id="login-section">
    <button onclick="loginGoogle()">Se connecter avec Google</button>
  </section>

  <!-- Section profil -->
  <section id="profile-section">
    <img id="profile-photo" src="">
    <h3 id="profile-name"></h3>
    <div id="dream-input">
      <textarea id="dream-text" placeholder="Ã‰cris ton rÃªve ici..."></textarea>
      <input type="file" id="dream-image" accept="image/*">
      <button onclick="postDream()">Poster ton rÃªve</button>
      <button onclick="logout()">DÃ©connexion</button>
    </div>
  </section>

  <!-- Feed des rÃªves -->
  <section id="dream-list"></section>

  <footer>
    &copy; 2026 Dreamers. Tous droits rÃ©servÃ©s.
  </footer>

</body>
</html>
