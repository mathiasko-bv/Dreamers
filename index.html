<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dreamers - Share Your Dreams</title>
<link rel="icon" href="logo.png">

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA-oYY7TrkutoUzT6TDyv-2zXYrv8jQ8Qk",
    authDomain: "dreamers-28315.firebaseapp.com",
    projectId: "dreamers-28315",
    storageBucket: "dreamers-28315.firebasestorage.app",
    messagingSenderId: "2129659896",
    appId: "1:2129659896:web:5c9b6f0188a90085c6f80d",
    measurementId: "G-6PEQFPTJ7N"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);
  const provider = new GoogleAuthProvider();

  // Connexion Google
  window.loginGoogle = async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;
      console.log("Connect√©:", user.displayName);
    } catch (err) { alert("Erreur: " + err.message); }
  };

  // D√©connexion
  window.logout = async () => {
    await signOut(auth);
    document.getElementById('login-section').style.display = 'block';
    document.getElementById('profile-section').style.display = 'none';
  };

  // Modifier profil
  window.updateProfileInfo = async () => {
    const name = document.getElementById('edit-name').value;
    const fileInput = document.getElementById('edit-photo');
    let photoURL = auth.currentUser.photoURL;

    if(fileInput.files.length > 0){
      const file = fileInput.files[0];
      const storageRef = ref(storage, 'users/' + auth.currentUser.uid + '_' + Date.now());
      await uploadBytes(storageRef, file);
      photoURL = await getDownloadURL(storageRef);
    }

    await updateProfile(auth.currentUser, { displayName: name, photoURL });
    document.getElementById('profile-name').innerText = auth.currentUser.displayName;
    document.getElementById('profile-photo').src = auth.currentUser.photoURL;
  };

  // Poster un r√™ve
  window.postDream = async () => {
    const dreamText = document.getElementById('dream-text').value;
    const fileInput = document.getElementById('dream-image');
    if (!dreamText) return alert("√âcris ton r√™ve !");
    let imageUrl = '';
    if(fileInput.files.length > 0){
      const file = fileInput.files[0];
      const storageRef = ref(storage, 'dreams/' + Date.now() + "_" + file.name);
      await uploadBytes(storageRef, file);
      imageUrl = await getDownloadURL(storageRef);
    }
    await addDoc(collection(db, 'dreams'), {
      text: dreamText,
      image: imageUrl,
      user: auth.currentUser.displayName,
      photo: auth.currentUser.photoURL,
      uid: auth.currentUser.uid,
      likes: 0,
      createdAt: new Date()
    });
    document.getElementById('dream-text').value = '';
    document.getElementById('dream-image').value = '';
    alert("Ton r√™ve a √©t√© post√© üåü"); // notification
  };

  // Like un r√™ve
  window.likeDream = async (id) => {
    const docRef = doc(db, 'dreams', id);
    await updateDoc(docRef, { likes: increment(1) });
  };

  // Auth state
  onAuthStateChanged(auth, user => {
    if(user){
      document.getElementById('login-section').style.display = 'none';
      document.getElementById('profile-section').style.display = 'block';
      document.getElementById('profile-name').innerText = user.displayName;
      document.getElementById('profile-photo').src = user.photoURL;
    } else {
      document.getElementById('login-section').style.display = 'block';
      document.getElementById('profile-section').style.display = 'none';
    }
  });

  // Afficher les r√™ves
  const dreamList = document.getElementById('dream-list');
  const q = query(collection(db, 'dreams'), orderBy('createdAt','desc'));
  onSnapshot(q, (snapshot) => {
    dreamList.innerHTML = '';
    snapshot.forEach(docItem => {
      const data = docItem.data();
      const div = document.createElement('div');
      div.className = 'dream-card';
      div.innerHTML = `
        <img src="${data.photo}" class="user-photo">
        <h4>${data.user}</h4>
        <p>${data.text}</p>
        ${data.image ? `<img src="${data.image}" class="dream-image">` : ''}
        <div class="dream-actions">
          <button onclick="likeDream('${docItem.id}')">‚ù§Ô∏è ${data.likes || 0}</button>
          <a href="https://wa.me/?text=${encodeURIComponent(data.text)}" target="_blank">üîó Partager</a>
        </div>
      `;
      dreamList.appendChild(div);
    });
  });
</script>

<style>
body{margin:0;font-family:Arial,sans-serif;background:#0a1f2c;color:#f0f0f0;}
header{text-align:center;padding:40px 20px;background:#004d40;color:#00c2a0;box-shadow:0 5px 10px rgba(0,0,0,0.5);}
header h1{margin:0;font-size:3em;}
header p{margin:10px 0;font-size:1.2em;color:#a0f0e0;}

nav{display:flex;justify-content:center;gap:20px;background:#00332f;padding:15px;position:sticky;top:0;z-index:100;}
nav a{color:#00c2a0;text-decoration:none;font-weight:bold;padding:10px 20px;border-radius:50px;transition:0.3s;background:#004d40;}
nav a:hover{background:#00e0b0;color:#004d40;}

#login-section{text-align:center;padding:50px;}
#login-section button{background:#00c2a0;border:none;padding:15px 30px;border-radius:50px;color:#004d40;font-weight:bold;cursor:pointer;transition:0.3s;}
#login-section button:hover{background:#00e0b0;transform:scale(1.05);}

#profile-section{display:none;text-align:center;padding:30px;}
#profile-photo{width:80px;height:80px;border-radius:50%;}
#dream-input{margin-top:20px;display:flex;flex-direction:column;align-items:center;gap:10px;}
#dream-input textarea{width:300px;height:80px;border-radius:10px;padding:10px;resize:none;}
#dream-input input[type=file]{color:#fff;}
#dream-input button{background:#00c2a0;border:none;padding:10px 20px;border-radius:50px;font-weight:bold;cursor:pointer;transition:0.3s;}
#dream-input button:hover{background:#00e0b0;transform:scale(1.05);}

#edit-profile{margin:20px;display:flex;flex-direction:column;align-items:center;gap:10px;}
#edit-profile input[type=text], #edit-profile input[type=file]{width:250px;padding:8px;border-radius:10px;}

#dream-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;padding:20px;}
.dream-card{background:#004d40;border-radius:15px;padding:15px;text-align:center;box-shadow:0 5px 15px rgba(0,0,0,0.5);transition:0.3s;}
.dream-card:hover{transform:translateY(-5px) scale(1.02);box-shadow:0 10px 20px rgba(0,0,0,0.7);}
.dream-card h4{margin:10px 0 5px;color:#00e0b0;}
.dream-card p{color:#f0f0f0;}
.dream-card .dream-image{width:100%;border-radius:10px;margin-top:10px;}
.dream-card .user-photo{width:50px;height:50px;border-radius:50%;}
.dream-actions{margin-top:10px;}
.dream-actions button{background:#00c2a0;color:#004d40;border:none;padding:5px 10px;border-radius:50px;margin-right:5px;cursor:pointer;transition:0.3s;}
.dream-actions button:hover{background:#00e0b0;}

footer{text-align:center;padding:25px;background:#00332f;color:#00c2a0;}
</style>
</head>
<body>

<header>
<h1>Dreamers</h1>
<p>Share your dreams with the world üåü</p>
</header>

<nav>
<a href="#login-section">Connexion</a>
<a href="#dream-list">R√™ves</a>
<a href="#profile-section">Profil</a>
<a href="https://chat.whatsapp.com/EWxI8orHwge3Zj0wQxAkba" target="_blank">Communaut√©</a>
</nav>

<!-- Connexion -->
<section id="login-section">
  <button onclick="loginGoogle()">Se connecter avec Google</button>
</section>

<!-- Profil -->
<section id="profile-section">
  <img id="profile-photo" src="">
  <h3 id="profile-name"></h3>

  <div id="edit-profile">
    <input type="text" id="edit-name" placeholder="Modifier pseudo">
    <input type="file" id="edit-photo" accept="image/*">
    <button onclick="updateProfileInfo()">Mettre √† jour profil</button>
  </div>

  <div id="dream-input">
    <textarea id="dream-text" placeholder="√âcris ton r√™ve ici..."></textarea>
    <input type="file" id="dream-image" accept="image/*">
    <button onclick="postDream()">Poster ton r√™ve</button>
    <button onclick="logout()">D√©connexion</button>
  </div>
</section>

<!-- Feed -->
<section id="dream-list"></section>

<footer>
&copy; 2026 Dreamers. Tous droits r√©serv√©s.
</footer>

</body>
</html>
